# 修改问题反馈记录

## 2026-01-21：增加中英文切换（i18n）

- 需求：遍历项目，增加语言功能，保证中英文可以切换
- 实现范围：
  - Electron 桌面端：通过 Settings → Preferences → Language 切换并持久化到 `~/.craft-agent/preferences.json`
  - Viewer Web 端：通过右上角语言按钮切换并持久化到 `localStorage(craft-language)`
  - 共享 UI 包：为部分通用交互文案接入 i18n（复制、关闭、附件提示、部分文件类型标签）
- 关键改动点（按模块）：
  - i18n 基础设施：引入 `i18next` / `react-i18next`，新增各端 i18n 初始化与 locales 资源
  - Electron：新增 preferences 变更广播与 renderer 订阅，语言变化实时更新 UI
  - Viewer：新增语言读写与切换逻辑，Viewer 页面文案迁移到 i18n
  - packages/ui：新增 `@craft-agent/ui/i18n` 导出与基础词条，部分组件替换为 `useTranslation('ui')`
- 验证/修复：
  - 通过 TypeScript 校验与 `bun test`
  - 修复若干历史类型问题（zod record 签名、sonner props、权限配置字段、bash-parser 声明、JSONPreviewOverlay 类型）

